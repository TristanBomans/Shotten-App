"use strict";(()=>{var e={};e.id=916,e.ids=[916],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6818:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>_,patchFetch:()=>f,requestAsyncStorage:()=>m,routeModule:()=>c,serverHooks:()=>p,staticGenerationAsyncStorage:()=>u});var r={};a.r(r),a.d(r,{PUT:()=>l});var n=a(9303),s=a(8716),i=a(670),o=a(7070),d=a(5662);async function l(e,{params:t}){try{let{matchId:a,playerId:r}=await t,n=parseInt(a),s=parseInt(r),{searchParams:i}=new URL(e.url),l=i.get("status");if(!l||!["Present","NotPresent","Maybe"].includes(l))return o.NextResponse.json({error:"Invalid status. Must be Present, NotPresent, or Maybe"},{status:400});let c=await (0,d.$c)(n,s,l);return o.NextResponse.json({matchId:c.match_id,playerId:c.player_id,status:c.status})}catch(e){return console.error("Error updating attendance:",e),o.NextResponse.json({error:"Server Error"},{status:500})}}let c=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/matches/[matchId]/players/[playerId]/attendance/route",pathname:"/api/matches/[matchId]/players/[playerId]/attendance",filename:"route",bundlePath:"app/api/matches/[matchId]/players/[playerId]/attendance/route"},resolvedPagePath:"/home/tristan/Documents/projects/Shotten-App/app/api/matches/[matchId]/players/[playerId]/attendance/route.ts",nextConfigOutput:"standalone",userland:r}),{requestAsyncStorage:m,staticGenerationAsyncStorage:u,serverHooks:p}=c,_="/api/matches/[matchId]/players/[playerId]/attendance/route";function f(){return(0,i.patchFetch)({serverHooks:p,staticGenerationAsyncStorage:u})}},5662:(e,t,a)=>{a.d(t,{$c:()=>x,CP:()=>m,EG:()=>f,G6:()=>h,IP:()=>w,K5:()=>p,OJ:()=>_,Pi:()=>u,Tb:()=>g,a9:()=>q,bu:()=>I,dG:()=>b,eb:()=>S,hY:()=>M,nc:()=>A,ro:()=>E,uZ:()=>k,vu:()=>j,wM:()=>N,y0:()=>y,yx:()=>v});var r=a(7857);let n=process.env.NEXT_PUBLIC_SUPABASE_URL||"https://bvwjoptvnxpttwkstiue.supabase.co",s=process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"sb_publishable_YaWg2zCaLJqZrVYv0K-9sQ_vXXYEImm",i=process.env.SUPABASE_SERVICE_KEY||"",o=null;function d(){return o||(o=(0,r.eI)(n,s)),o}let l=null;function c(){return l||(l=(0,r.eI)(n,i||s)),l}async function m(){let{data:e,error:t}=await d().from("core_players").select("*").order("id");if(t)throw t;return e||[]}async function u(e){let{data:t,error:a}=await d().from("core_players").select("*").eq("id",e).single();return a?null:t}async function p(e,t=[]){let{data:a,error:r}=await c().from("core_players").insert({name:e,team_ids:t}).select().single();if(r)throw r;return a}async function _(e,t,a){let{data:r,error:n}=await c().from("core_players").update({name:t,team_ids:a}).eq("id",e).select().single();if(n)throw n;return r}async function f(e){await c().from("attendances").delete().eq("player_id",e);let{error:t}=await c().from("core_players").delete().eq("id",e);if(t)throw t}async function y(){let{data:e,error:t}=await d().from("core_teams").select("*").order("id");if(t)throw t;return e||[]}async function h(e){let t=d().from("core_matches").select("*").order("date");if(e){let a=await u(e);if(!a||0===a.team_ids.length)return[];t=t.in("team_id",a.team_ids)}let{data:a,error:r}=await t;if(r)throw r;return a||[]}async function w(e){let{data:t,error:a}=await d().from("core_matches").select("*").eq("id",e).single();return a?null:t}async function g(e){let{data:t,error:a}=await c().from("core_matches").insert(e).select().single();if(a)throw a;let r=await m();if(r.length>0){let e=r.map(e=>({match_id:t.id,player_id:e.id,status:"NotPresent"}));await c().from("attendances").insert(e)}return t}async function v(e,t){let{data:a,error:r}=await c().from("core_matches").update(t).eq("id",e).select().single();if(r)throw r;return a}async function I(e){await c().from("attendances").delete().eq("match_id",e);let{error:t}=await c().from("core_matches").delete().eq("id",e);if(t)throw t}async function P(e){let{data:t,error:a}=await d().from("attendances").select("*").in("match_id",e);if(a)throw a;return t||[]}async function x(e,t,a){let{data:r,error:n}=await c().from("attendances").upsert({match_id:e,player_id:t,status:a},{onConflict:"match_id,player_id"}).select().single();if(n)throw n;return r}async function b(){let{data:e,error:t}=await d().from("lzv_teams").select("*").order("rank");if(t)throw t;return e||[]}async function q(e){let{data:t,error:a}=await d().from("lzv_teams").select("*").eq("external_id",e).single();return a?null:t}async function E(e){let t=d().from("lzv_matches").select("*").order("date");e&&(t=t.eq("team_id",e));let{data:a,error:r}=await t;if(r)throw r;return a||[]}async function A(e){let{data:t,error:a}=await d().from("lzv_players").select("*");if(a)throw a;if(!t)return[];let r=t.map(e=>e.id),{data:n,error:s}=await d().from("lzv_player_team_stats").select("*").in("player_id",r);if(s)throw s;let i=new Map;for(let e of n||[])i.has(e.player_id)||i.set(e.player_id,[]),i.get(e.player_id).push(e);let o=[];for(let a of t){let t=i.get(a.id)||[];if(e){let r=t.find(t=>t.team_id===e);r&&o.push({externalId:a.external_id,name:a.name,teamId:r.team_id,number:r.jersey_number??void 0,gamesPlayed:r.games_played,goals:r.goals,assists:r.assists,fairplayRank:r.fairplay_rank??void 0,teamIds:t.map(e=>e.team_id)})}else{let e=t.reduce((e,t)=>e+t.goals,0),r=t.reduce((e,t)=>e+t.assists,0),n=t.reduce((e,t)=>e+t.games_played,0);o.push({externalId:a.external_id,name:a.name,teamId:t[0]?.team_id||0,number:t[0]?.jersey_number??void 0,gamesPlayed:n,goals:e,assists:r,teamIds:t.map(e=>e.team_id),teamStats:t.map(e=>({teamId:e.team_id,number:e.jersey_number??void 0,gamesPlayed:e.games_played,goals:e.goals,assists:e.assists,fairplayRank:e.fairplay_rank??void 0}))})}}return o.sort((e,t)=>t.goals-e.goals),o}function N(e){return{id:e.id,name:e.name,teamIds:e.team_ids}}function S(e){return{id:e.id,name:e.name}}async function j(e){let t=await P([e.id]),a=new Map((await m()).map(e=>[e.id,e]));return{id:e.id,date:e.date,location:e.location,name:e.name,teamName:e.team_name,teamId:e.team_id,attendances:t.map(e=>{let t=a.get(e.player_id);return{matchId:e.match_id,playerId:e.player_id,player:t?N(t):null,status:e.status}})}}async function k(e){if(0===e.length)return[];let t=e.map(e=>e.id),a=await P(t),r=new Map((await m()).map(e=>[e.id,e])),n=new Map;for(let e of a)n.has(e.match_id)||n.set(e.match_id,[]),n.get(e.match_id).push(e);return e.map(e=>({id:e.id,date:e.date,location:e.location,name:e.name,teamName:e.team_name,teamId:e.team_id,attendances:(n.get(e.id)||[]).map(e=>{let t=r.get(e.player_id);return{matchId:e.match_id,playerId:e.player_id,player:t?N(t):null,status:e.status}})}))}function M(e){return{externalId:e.external_id,name:e.name,leagueId:e.league_id??void 0,leagueName:e.league_name??void 0,rank:e.rank??void 0,points:e.points??void 0,matchesPlayed:e.matches_played??void 0,wins:e.wins??void 0,draws:e.draws??void 0,losses:e.losses??void 0,goalsFor:e.goals_for??void 0,goalsAgainst:e.goals_against??void 0,goalDifference:e.goal_difference??void 0,pointsPerMatch:e.points_per_match??void 0,form:e.form??void 0,colors:e.colors??void 0,manager:e.manager??void 0,description:e.description??void 0,imageBase64:e.image_base64??void 0}}}};var t=require("../../../../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[948,564],()=>a(6818));module.exports=r})();